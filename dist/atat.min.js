!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.atat=e():t.atat=e()}(window,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=2)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1);function i(t,e){if("[object Array]"===Object.prototype.toString.call(t))for(var n=0,r=(t=t).length;n<r;n++)e(t[n],n,t);else for(var i in t=t)t.hasOwnProperty(i)&&e(t[i],i,t)}function o(t){return void 0===t&&(t=""),t.toString().replace(r.MATCH_HTML,function(t){return r.HTML_RULES[t]||t})}function u(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(0==e.length)return String.prototype.trim.call(t);for(;e.indexOf(t.charAt(0))>=0;)t=t.substring(1);for(;e.indexOf(t.charAt(t.length-1))>=0;)t=t.substring(0,t.length-1);return t}function a(t){return JSON.stringify(t)}function l(t,e){return void 0===t&&(t=[]),void 0===e&&(e=""),Array.prototype.join.call(t,e)}function s(t){return void 0===t&&(t=""),t.toString().toUpperCase()}function c(t){return void 0===t&&(t=""),t.toString().toLowerCase()}e.helpers={encode:o,json:a,join:l,upper:s,lower:c},e.merge=function t(e,n){for(var r in void 0===n&&(n={}),e)!n.hasOwnProperty(r)&&e.hasOwnProperty(r)&&("object"==typeof e[r]?n[r]=t(e[r]):n[r]=e[r]);return n},e.get_tags=function(t){var e=[];i(t,function(t,n){-1===e.indexOf(n)&&e.push(n)});var n=[];return i(t,function(t,e){n.push({compiler:t,regexp:new RegExp(e,"g")})}),{open:new RegExp(e.join("|"),"g"),close:/}@/g,compilers:n}},e.get_tags_inline=function(t){var e=[];return i(t,function(t,n){e.push(n)}),e.push("(@[A-Za-z0-9$]+\\()([^]*?)(\\)@)"),new RegExp(e.join("|"),"g")},e.loop=i,e.loop_async=function(t,e,n){for(var r=0,i=!1,o=[],u=t.length,a=0;a<u;a++)e(t[a],a,t,l(a));function l(t){return function(e,a){if(!i){if(e)return i=!0,void n(e);o[t]=a,++r==u&&(i=!0,n(null,o))}}}},e.encode_html=o,e.trim_string=u,e.escape_quotes=function(t){return u(t).replace(/^"(.*)"$/g,"$1").replace(/^'(.*)'$/g,"$1")},e.json_stringify=a,e.join_helper=l,e.uppercase_helper=s,e.lowercase_helper=c,e.resolveUrl=function(t,e){var n=t.split("/"),r=e.split("/");n.pop();for(var i=0;i<r.length;i++)"."!=r[i]&&(".."==r[i]?n.pop():n.push(r[i]));return n.join("/")}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.noop=function(){},e.VALUE_NAME_OUTSIDE="outside",e.VALUE_NAME_INSIDE="inside",e.HTML_RULES={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},e.CLEAR_TAGS=/[-[\](){}*+?.,\\^$|#\s]/g,e.MATCH_HTML=/&(?!#?\w+;)|<|>|"|'|\//g},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(6),i=n(4),o=n(8),u=n(1),a=n(9),l=n(0);e.atat={config:function(t){for(var e in t=l.merge(i.AtatDefaultOpions,t))i.AtatDefaultOpions.hasOwnProperty(e)&&(i.AtatDefaultOpions[e]=t[e])},parse:function(t,n,i){if(void 0===n&&(n={}),void 0===i&&(i=u.noop),"function"==typeof n&&(i=n,n={}),i===u.noop&&"undefined"!=typeof Promise)return new Promise(function(r,i){e.atat.parse(t,n,function(t,e){t?i(t):r(e)})});var a=new r.AtatContext(n);(new o.AtatCompiler).compile(t,a,function(t,e){if(t)return i(t);var n=new Function(a.arguments,e+";return this.output;");a.template=function(t){try{a.output="",a.model=t||a.model;var e=n.call(a,a.model,a.helpers,a.body);return a.layout&&(a.layout.context.body=e,e=a.layout(a.model)),e}catch(t){return t.toString()}},a.template.context=a,i(null,a.template)})},loadAndParse:function(t,n,r){if(void 0===n&&(n={}),void 0===r&&(r=u.noop),"function"==typeof n&&(r=n,n={}),r===u.noop&&"undefined"!=typeof Promise)return new Promise(function(r,i){e.atat.loadAndParse(t,n,function(t,e){t?i(t):r(e)})});a.load_file(t,function(t,i){t?r(t):e.atat.parse(i,n,r)})},render:function(t,n,r,i){if(void 0===n&&(n={}),void 0===r&&(r={}),void 0===i&&(i=u.noop),"function"==typeof r&&(i=r,r={}),i===u.noop&&"undefined"!=typeof Promise)return new Promise(function(i,o){e.atat.render(t,n,r,function(t,e){t?o(t):i(e)})});e.atat.parse(t,r,function(t,e){t?i(t):i(null,e(n))})},loadAndRender:function(t,n,r,i){if(void 0===r&&(r={}),void 0===i&&(i=u.noop),"function"==typeof r&&(i=r,r={}),i===u.noop&&"undefined"!=typeof Promise)return new Promise(function(i,o){e.atat.loadAndRender(t,n,r,function(t,e){t?o(t):i(e)})});e.atat.loadAndParse(t,r,function(t,e){t?i(t):i(null,e(n))})},__express:function(t,n,r){e.atat.loadAndParse(t,function(t,e){t?r(t.toString()):r(null,e(n))})}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1);function i(t,e,n){void 0===n&&(n=0),e.lastIndex=n;var r=e.exec(t);return e.global&&(e.lastIndex=r?e.lastIndex:0),r}function o(t){for(var e=0;e<t.length;e++)void 0===t[e]&&(t.splice(e,1),e--)}e.match_recursive=function(t,e,n){for(var o,u,a,l,s=e.global,c=e.sticky,f=[],p=0,d=0,v=0,h=0;;){if(a=i(t,e,v),l=i(t,n,v),a&&l&&(a.index<=l.index?l=null:a=null),a||l)v=(d=(a||l).index)+(a||l)[0].length;else if(!p)break;if(c&&!p&&d>h)break;if(a)p||(o=d,u=v),++p;else{if(!l||!p)throw new Error("Unbalanced delimiter found in string");if(!--p&&(o>h&&f.push({name:r.VALUE_NAME_OUTSIDE,value:t.slice(h,o),start:h,end:o}),f.push({name:r.VALUE_NAME_INSIDE,value:t.slice(u,d),start:u,end:d,left:{value:t.slice(o,u),start:o,end:u},right:{value:t.slice(d,v),start:d,end:v}}),h=v,!s))break}d===v&&++v}return s&&t.length>h&&f.push({name:r.VALUE_NAME_OUTSIDE,value:t.slice(h),start:h,end:t.length}),f},e.regexp_test=function(t,e,n){void 0===n&&(n=0),e.lastIndex=n;var r=e.test(t);return e.global&&(e.lastIndex=r?e.lastIndex:0),r},e.regexp_exec=i,e.clean_array=o,e.match_inline=function(t,e){for(var n,u,a=e.global,l=e.sticky,s=[],c=0,f=0;;){var p=i(t,e,c);if(null==p)break;if(f=p.index,l&&f>c)break;if(o(p),u=c+(n=f+p[1].length)+p[2].length,f>c&&s.push({name:r.VALUE_NAME_OUTSIDE,value:t.slice(c,f),start:c,end:f}),s.push({name:r.VALUE_NAME_INSIDE,value:p[2],start:n,end:u,left:{value:p[1],start:f,end:n},right:{value:p[3],start:u,end:u+p[3].length}}),c=f+p[0].length,!a)break}return a&&t.length>c&&s.push({name:r.VALUE_NAME_OUTSIDE,value:t.slice(c),start:c,end:t.length}),s}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AtatDefaultOpions={it:"it",$:"$",basepath:"",cache:!0,helpers:{}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(0),i=n(2);e.inline_tags={"(@section\\()([^]*?)(\\)@)":function(t,e,n){try{var i=r.escape_quotes(t.value),o="this.output += (function(){var s = this.section('"+i+"'); return s?s("+e.arguments+'):"";}).call(this);';n(null,o)}catch(t){n(t)}},"(@layout\\()([^]*?)(\\)@)":function(t,e,n){try{if(e.layout)return n();i.atat.loadAndParse(r.escape_quotes(t.value),e.options,function(t,r){if(t)return n(t);e.layout=r,r.context.parent=e,n()})}catch(t){n(t)}},"(@partial\\()([^]*?)(\\)@)":function(t,e,n){try{var o=t.value.trim();if(""==o)return n(new Error("Partial parsing error"));var u=o.split(/\s*,\s*/g),a=r.escape_quotes(u.shift());i.atat.loadAndParse(a,e.options,function(t,r){if(t)return n(t);e.partials.push(r),r.context.parent=e;var i="this.output += this.partials["+(e.partials.length-1)+"]("+u+");";n(null,i)})}catch(t){n(t)}},"(@\\()([^]*?)(\\)@)":function(t,e,n){try{var r=t.value.trim();""===r&&n(),n(null,"this.output += this.helpers.encode("+t.value.trim()+");")}catch(t){n(t)}},"(@!\\()([^]*?)(\\)@)":function(t,e,n){try{var r=t.value.trim();""===r&&n(),n(null,"this.output += ("+t.value.trim()+");")}catch(t){n(t)}}},e.output_call_helper=function(t,e,n){try{var r=t.left.value.substring(1,t.left.value.length-1);if("function"!=typeof e.helpers[r])throw'Helper "'+r+"\" didn't declarated";n(null,"this.output += this.helpers."+r+"("+t.value.trim()+");")}catch(t){n(t)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(4),i=n(0),o=n(3),u=n(5),a=n(7),l=function(){function t(t){var e=this;this.options=i.merge(r.AtatDefaultOpions,t),this.helpers=i.merge(i.helpers,t.helpers),this.model=null,this.output="",this.parts=[],this.parent=null,this.arguments=[this.options.it,this.options.$,"body"].join(","),this.tags=i.get_tags(a.tags),this.inline=i.get_tags_inline(u.inline_tags),i.loop(u.inline_tags,function(t,n){e.tags.compilers.push({compiler:t,regexp:new RegExp(n,"g")})}),this.layout=null,this.partials=[],this.sections={}}return t.prototype.section=function(t){return t?this.sections[t]||this.parent&&this.parent.section(t):null},t.prototype.compiler=function(t){void 0===t&&(t="");for(var e=0,n=this.tags.compilers.length;e<n;e++){var r=this.tags.compilers[e];if(o.regexp_test(t,r.regexp))return r.compiler}return null},t}();e.AtatContext=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(3),o=n(0),u=n(2);e.tags={"@\\{":function(t,e,n){n(null,t.value.trim())},"@if\\s*\\(":function(t,e,n){var u=this,a="if("+t.value+"}",l=i.match_recursive(a,/\{/g,/\}/g);o.loop_async(l,function(t,n,i,o){if(t.name==r.VALUE_NAME_OUTSIDE)return o(null,t.value);u.compile(t.value,e,o)},function(t,e){if(t)return n(t);n(null,e.join(""))})},"@while\\s*\\(":function(t,e,n){var r="while("+t.value+"}",o=i.match_recursive(r,/\{/g,/\}/g),u="";u+=o[0].value,u+="{",this.compile(o[1].value,e,function(t,e){if(t)return n(t);u+=e,n(null,u+="}")})},"@for\\s*\\(":function(t,e,n){var r="for("+t.value+"}",o=i.match_recursive(r,/\{/g,/\}/g),u="";u+=o[0].value,u+="{",this.compile(o[1].value,e,function(t,e){if(t)return n(t);u+=e,n(null,u+="}")})},"@function\\s+[$A-Za-z0-9]*\\s*\\(":function(t,e,n){var r=t.left.value.trim().substring(1);n(null,r+t.value.trim()+"}")},"@section\\s+[$A-Za-z0-9]*\\s*\\{":function(t,e,n){var r=t.value.trim(),o=t.left.value.trim(),a=i.regexp_exec(o,/^@section\s+([A-Za-z0-9]+)\s*\{/g);if(!a||a.length>2)return n(new Error("Section parsing error"));var l=a[1].trim();if(e.sections[l])return n(new Error("Section already exists"));u.atat.parse(r,e.options,function(t,r){if(t)return n(t);r.context.parent=e,e.sections[l]=r,n(null)})}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n(0),o=n(3),u=n(5),a=function(){function t(){}return t.prototype.compile=function(t,e,n){var u=this;try{if(0==t.length)return void n(null,"");var a=o.match_recursive(t,e.tags.open,e.tags.close);i.loop_async(a,function(t,n,i,o){try{if(t.name==r.VALUE_NAME_OUTSIDE)return""==t.value.trim()?void o(null,""):void u.compile_inline(t.value,e,o);if(t.name==r.VALUE_NAME_INSIDE){var a=t.left,l=t,s=t.right,c=e.compiler(a.value);return c?void c.call(u,l,e,o):void u.compile_inline(a.value+l.value+s.value,e,o)}}catch(t){o(t)}},function(t,e){if(t)return n(t);n(null,e.join(""))})}catch(t){n(t)}},t.prototype.compile_inline=function(t,e,n){var a=this;try{if(0==t.length)return void n(null,"");var l=o.match_inline(t,e.inline);i.loop_async(l,function(t,n,i,o){try{if(t.name==r.VALUE_NAME_OUTSIDE)return e.parts.push(t.value),void o(null,"this.output += this.parts["+(e.parts.length-1)+"];");if(t.name==r.VALUE_NAME_INSIDE){var l=t.left,s=t,c=t.right;if(""==s.value.trim())return void o(null,"");var f=e.compiler(l.value+s.value+c.value);return f?void f.call(a,s,e,o):void u.output_call_helper.call(a,s,e,o)}}catch(t){o(t)}},function(t,e){if(t)return n(t);n(null,e.join(""))})}catch(t){n(t)}},t}();e.AtatCompiler=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.load_file=function(t,e){var n=new XMLHttpRequest;n.open("GET",t,!0),n.onreadystatechange=function(){4===this.readyState&&(this.status>=200&&this.status<400?e(null,this.responseText):e(new Error('Not able to load template "'+t+'"')))},n.send(),n=null}}]).atat});
//# sourceMappingURL=atat.min.js.map