!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.atat=t():e.atat=t()}(window,function(){return(r={},o.m=n=[function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.noop=function(){},t.VALUE_NAME_OUTSIDE="outside",t.VALUE_NAME_INSIDE="inside",t.HTML_RULES={'"':"&#34;","&":"&#38;","'":"&#39;","/":"&#47;","<":"&#60;",">":"&#62;"},t.CLEAR_TAGS=/[-[\](){}*+?.,\\^$|#\s]/g,t.MATCH_HTML=/&(?!#?\w+;)|<|>|"|'|\//g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);function o(e,t){if("[object Array]"===Object.prototype.toString.call(e))for(var n=0,r=e.length;n<r;n+=1)t(e[n],n,e);else for(var o in e)e.hasOwnProperty(o)&&t(e[o],o,e)}function i(e){return void 0===e&&(e=""),e.toString().replace(r.MATCH_HTML,function(e){return r.HTML_RULES[e]||e})}function u(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(0===t.length)return String.prototype.trim.call(e);for(var r=e;0<=t.indexOf(e.charAt(0));)r=e.substring(1);for(;0<=t.indexOf(e.charAt(e.length-1));)r=e.substring(0,e.length-1);return r}function l(e){return JSON.stringify(e)}function a(e,t){return void 0===e&&(e=[]),void 0===t&&(t=""),Array.prototype.join.call(e,t)}function s(e){return void 0===e&&(e=""),e.toString().toUpperCase()}function c(e){return void 0===e&&(e=""),e.toString().toLowerCase()}t.helpers={encode:i,join:a,json:l,lower:c,upper:s},t.merge=function e(t,n){for(var r in void 0===n&&(n={}),t)!n.hasOwnProperty(r)&&t.hasOwnProperty(r)&&("object"==typeof t[r]?n[r]=e(t[r]):n[r]=t[r]);return n},t.getTags=function(e){var n=[];o(e,function(e,t){-1===n.indexOf(t)&&n.push(t)});var r=[];return o(e,function(e,t){r.push({compiler:e,regexp:new RegExp(t,"g")})}),{compilers:r,close:/}@/g,open:new RegExp(n.join("|"),"g")}},t.getTagsInline=function(e){var n=[];return o(e,function(e,t){n.push(t)}),n.push("(@[A-Za-z0-9$]+\\()([^]*?)(\\)@)"),new RegExp(n.join("|"),"g")},t.loop=o,t.loopAsync=function(e,t,r){for(var o=0,i=!1,u=[],l=e.length,n=0;n<l;n+=1)t(e[n],n,e,a(n));function a(n){return function(e,t){if(!i){if(e)return i=!0,void r(e);u[n]=t,(o+=1)===l&&(i=!0,r(null,u))}}}},t.encodeHtml=i,t.trimString=u,t.escapeQuotes=function(e){return u(e).replace(/^"(.*)"$/g,"$1").replace(/^'(.*)'$/g,"$1")},t.jsonStringify=l,t.joinHelper=a,t.uppercaseHelper=s,t.lowercaseHelper=c,t.resolveUrl=function(e,t){var n=e.split("/"),r=t.split("/");n.pop();for(var o=0,i=r;o<i.length;o++){var u=i[o];"."!==u&&(".."===u?n.pop():n.push(u))}return n.join("/")}},function(e,u,t){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var l=t(0),a=t(6),s=t(7),r=t(1),i=t(5);u.atat={config:function(e){var t=r.merge(i.DEFAULT_OPTIONS,e);for(var n in t)i.DEFAULT_OPTIONS.hasOwnProperty(n)&&(i.DEFAULT_OPTIONS[n]=t[n])},parse:function(e,t,n){void 0===t&&(t={}),void 0===n&&(n=l.noop);var o=t,r=n;if("function"==typeof o&&(r=o,o={}),r===l.noop&&"undefined"!=typeof Promise)return new Promise(function(n,r){u.atat.parse(e,o,function(e,t){e?r(e):n(t)})});var i=new s.AtatContext(o);(new a.AtatCompiler).compile(e,i,function(e,t){if(e)return r(e);var n=new Function(i.arguments,t+";return this.output;");i.template=function(e){try{i.output="",i.model=e||i.model;var t=n.call(i,i.model,i.helpers,i.body);return i.layout&&(i.layout.context.body=t,t=i.layout(i.model)),t}catch(e){return e.toString()}},i.template.context=i,r(null,i.template)})},loadAndParse:function(e,t,n){void 0===t&&(t={}),void 0===n&&(n=l.noop);var o=t,r=n;if("function"==typeof o&&(r=o,o={}),r===l.noop&&"undefined"!=typeof Promise)return new Promise(function(n,r){u.atat.loadAndParse(e,o,function(e,t){e?r(e):n(t)})});(o.fileResolver||i.DEFAULT_OPTIONS.fileResolver).loadFile(e,function(e,t){e?r(e):u.atat.parse(t,o,r)})},render:function(e,o,t,n){void 0===o&&(o={}),void 0===t&&(t={}),void 0===n&&(n=l.noop);var i=t,r=n;if("function"==typeof i&&(r=i,i={}),r===l.noop&&"undefined"!=typeof Promise)return new Promise(function(n,r){u.atat.render(e,o,i,function(e,t){e?r(e):n(t)})});u.atat.parse(e,i,function(e,t){e?r(e):r(null,t(o))})},loadAndRender:function(e,o,t,n){void 0===t&&(t={}),void 0===n&&(n=l.noop);var i=t,r=n;if("function"==typeof i&&(r=i,i={}),r===l.noop&&"undefined"!=typeof Promise)return new Promise(function(n,r){u.atat.loadAndRender(e,o,i,function(e,t){e?r(e):n(t)})});u.atat.loadAndParse(e,i,function(e,t){e?r(e):r(null,t(o))})},__express:function(e,n,r){u.atat.loadAndParse(e,function(e,t){e?r(e.toString()):r(null,t(n))})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=n(0);function h(e,t,n){void 0===n&&(n=0),t.lastIndex=n;var r=t.exec(e);return t.global&&(t.lastIndex=r?t.lastIndex:0),r}function c(e){for(var t=0;t<e.length;t+=1)void 0===e[t]&&(e.splice(t,1),t-=1)}t.matchRecursive=function(e,t,n){for(var r,o,i,u,l=t.global,a=t.sticky,s=[],c=0,f=0,p=0,v=0;;){if(i=h(e,t,p),u=h(e,n,p),i&&u&&(i.index<=u.index?u=null:i=null),i||u)p=(f=(i||u).index)+(i||u)[0].length;else if(!c)break;if(a&&!c&&v<f)break;if(i)c||(r=f,o=p),c+=1;else{if(!u||!c)throw new Error("Unbalanced delimiter found in string");if(!(c-=1)&&(v<r&&s.push({name:d.VALUE_NAME_OUTSIDE,value:e.slice(v,r),start:v,end:r}),s.push({name:d.VALUE_NAME_INSIDE,value:e.slice(o,f),start:o,end:f,left:{value:e.slice(r,o),start:r,end:o},right:{value:e.slice(f,p),start:f,end:p}}),v=p,!l))break}f===p&&(p+=1)}return l&&e.length>v&&s.push({end:e.length,name:d.VALUE_NAME_OUTSIDE,start:v,value:e.slice(v)}),s},t.regexpTest=function(e,t,n){void 0===n&&(n=0),t.lastIndex=n;var r=t.test(e);return t.global&&(t.lastIndex=r?t.lastIndex:0),r},t.regexpExec=h,t.cleanArray=c,t.matchInline=function(e,t){for(var n,r,o=t.global,i=t.sticky,u=[],l=0,a=0;;){var s=h(e,t,l);if(null===s)break;if(a=s.index,i&&l<a)break;if(c(s),r=l+(n=a+s[1].length)+s[2].length,l<a&&u.push({name:d.VALUE_NAME_OUTSIDE,value:e.slice(l,a),start:l,end:a}),u.push({name:d.VALUE_NAME_INSIDE,value:s[2],start:n,end:r,left:{value:s[1],start:a,end:n},right:{value:s[3],start:r,end:r+s[3].length}}),l=a+s[0].length,!o)break}return o&&e.length>l&&u.push({name:d.VALUE_NAME_OUTSIDE,value:e.slice(l),start:l,end:e.length}),u}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=n(2),l=n(1);t.inlineTags={"(@!\\()([^]*?)(\\)@)":function(e,t,n){try{""===e.value.trim()&&n(),n(null,"this.output += ("+e.value.trim()+");")}catch(e){n(e)}},"(@\\()([^]*?)(\\)@)":function(e,t,n){try{""===e.value.trim()&&n(),n(null,"this.output += this.helpers.encode("+e.value.trim()+");")}catch(e){n(e)}},"(@layout\\()([^]*?)(\\)@)":function(e,n,r){try{if(n.layout)return r();u.atat.loadAndParse(l.escapeQuotes(e.value),n.options,function(e,t){if(e)return r(e);(n.layout=t).context.parent=n,r()})}catch(e){r(e)}},"(@partial\\()([^]*?)(\\)@)":function(e,r,o){try{var t=e.value.trim();if(""===t)return o(new Error("Partial parsing error"));var i=t.split(/\s*,\s*/g),n=l.escapeQuotes(i.shift());u.atat.loadAndParse(n,r.options,function(e,t){if(e)return o(e);r.partials.push(t);var n="this.output += this.partials["+((t.context.parent=r).partials.length-1)+"]("+i+");";o(null,n)})}catch(e){o(e)}},"(@section\\()([^]*?)(\\)@)":function(e,t,n){try{var r="this.output += (function(){var s = this.section('"+l.escapeQuotes(e.value)+"'); return s?s("+t.arguments+'):"";}).call(this);';n(null,r)}catch(e){n(e)}}},t.outputCallHelper=function(e,t,n){try{var r=e.left.value.substring(1,e.left.value.length-1);if("function"!=typeof t.helpers[r])throw new Error("Helper "+r+" isn't declarated");n(null,"this.output += this.helpers."+r+"("+e.value.trim()+");")}catch(e){n(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8);t.DEFAULT_OPTIONS={it:"it",$:"$",helpers:{},fileResolver:new r.DefaultFileResolver}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=n(0),r=n(1),f=n(4),o=n(3),i=(u.prototype.compile=function(e,a,n){var s=this;try{if(0===e.length)return void n(null,"");var t=o.matchRecursive(e,a.tags.open,a.tags.close);r.loopAsync(t,function(e,t,n,r){try{if(e.name===c.VALUE_NAME_OUTSIDE)return""===e.value.trim()?void r(null,""):void s.compileInline(e.value,a,r);if(e.name===c.VALUE_NAME_INSIDE){var o=e.left,i=e,u=e.right,l=a.compiler(o.value);return l?void l.call(s,i,a,r):void s.compileInline(o.value+i.value+u.value,a,r)}}catch(e){r(e)}},function(e,t){if(e)return n(e);n(null,t.join(""))})}catch(e){n(e)}},u.prototype.compileInline=function(e,a,n){var s=this;try{if(0===e.length)return void n(null,"");var t=o.matchInline(e,a.inline);r.loopAsync(t,function(e,t,n,r){try{if(e.name===c.VALUE_NAME_OUTSIDE)return a.parts.push(e.value),void r(null,"this.output += this.parts["+(a.parts.length-1)+"];");if(e.name===c.VALUE_NAME_INSIDE){var o=e.left,i=e,u=e.right;if(""===i.value.trim())return void r(null,"");var l=a.compiler(o.value+i.value+u.value);return l?void l.call(s,i,a,r):void f.outputCallHelper.call(s,i,a,r)}}catch(e){r(e)}},function(e,t){if(e)return n(e);n(null,t.join(""))})}catch(e){n(e)}},u);function u(){}t.AtatCompiler=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),o=n(4),i=n(5),u=n(3),l=n(11),a=(s.prototype.section=function(e){return e?this.sections[e]||this.parent&&this.parent.section(e):null},s.prototype.compiler=function(e){void 0===e&&(e="");for(var t=0,n=this.tags.compilers.length;t<n;t+=1){var r=this.tags.compilers[t];if(u.regexpTest(e,r.regexp))return r.compiler}return null},s);function s(e){var n=this;this.options=r.merge(i.DEFAULT_OPTIONS,e),this.helpers=r.merge(r.helpers,e.helpers),this.model=null,this.output="",this.parts=[],this.parent=null,this.arguments=[this.options.it,this.options.$,"body"].join(","),this.tags=r.getTags(l.tags),this.inline=r.getTagsInline(o.inlineTags),r.loop(o.inlineTags,function(e,t){n.tags.compilers.push({compiler:e,regexp:new RegExp(t,"g")})}),this.layout=null,this.partials=[],this.sections={}}t.AtatContext=a},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(n(9));t.DefaultFileResolver=o.default;var i=r(n(10));t.FetchFileResolver=i.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});function r(){this.loadFile=function(e,t){try{n(!function(){var e=new Error("Cannot find module 'fs'");throw e.code="MODULE_NOT_FOUND",e}()).readFile(e,"utf-8",t)}catch(e){t(e)}}}t.default=r},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(i,u,l,a){return new(l=l||Promise)(function(e,t){function n(e){try{o(a.next(e))}catch(e){t(e)}}function r(e){try{o(a.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new l(function(e){e(t.value)}).then(n,r)}o((a=a.apply(i,u||[])).next())})},l=this&&this.__generator||function(n,r){var o,i,u,e,l={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,i&&(u=2&t[0]?i.return:t[0]?i.throw||((u=i.return)&&u.call(i),0):i.next)&&!(u=u.call(i,t[1])).done)return u;switch(i=0,u&&(t=[2&t[0],u.value]),t[0]){case 0:case 1:u=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,i=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(u=0<(u=l.trys).length&&u[u.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!u||t[1]>u[0]&&t[1]<u[3])){l.label=t[1];break}if(6===t[0]&&l.label<u[1]){l.label=u[1],u=t;break}if(u&&l.label<u[2]){l.label=u[2],l.ops.push(t);break}u[2]&&l.ops.pop(),l.trys.pop();continue}t=r.call(n,l)}catch(e){t=[6,e],i=0}finally{o=u=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(t,"__esModule",{value:!0});function o(){var e=this;this.loadFile=function(i,u){return r(e,void 0,void 0,function(){var t,n,r,o;return l(this,function(e){switch(e.label){case 0:return e.trys.push([0,3,,4]),[4,fetch(i)];case 1:return t=e.sent(),n=u,r=[null],[4,t.text()];case 2:return n.apply(void 0,r.concat([e.sent()])),[3,4];case 3:return o=e.sent(),u(o),[3,4];case 4:return[2]}})})}}t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=n(2),u=n(0),a=n(1),s=n(3);t.tags={"@\\{":function(e,t,n){n(null,e.value.trim())},"@for\\s*\\(":function(e,t,n){var r="for("+e.value+"}",o=s.matchRecursive(r,/\{/g,/\}/g),i="";i+=o[0].value,i+="{",this.compile(o[1].value,t,function(e,t){if(e)return n(e);i+=t,n(null,i+="}")})},"@function\\s+[$A-Za-z0-9]*\\s*\\(":function(e,t,n){var r=e.left.value.trim().substring(1);n(null,""+r+e.value.trim()+"}")},"@if\\s*\\(":function(e,o,n){var i=this,t="if("+e.value+"}",r=s.matchRecursive(t,/\{/g,/\}/g);a.loopAsync(r,function(e,t,n,r){if(e.name===u.VALUE_NAME_OUTSIDE)return r(null,e.value);i.compile(e.value,o,r)},function(e,t){if(e)return n(e);n(null,t.join(""))})},"@section\\s+[$A-Za-z0-9]*\\s*\\{":function(e,n,r){var t=e.value.trim(),o=e.left.value.trim(),i=s.regexpExec(o,/^@section\s+([A-Za-z0-9]+)\s*\{/g);if(!i||2<i.length)return r(new Error("Section parsing error"));var u=i[1].trim();if(n.sections[u])return r(new Error("Section already exists"));l.atat.parse(t,n.options,function(e,t){if(e)return r(e);(t.context.parent=n).sections[u]=t,r(null)})},"@while\\s*\\(":function(e,t,n){var r="while("+e.value+"}",o=s.matchRecursive(r,/\{/g,/\}/g),i="";i+=o[0].value,i+="{",this.compile(o[1].value,t,function(e,t){if(e)return n(e);i+=t,n(null,i+="}")})}}}],o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=2)).atat;function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}var n,r});
//# sourceMappingURL=atat.min.js.map