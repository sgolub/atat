!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.atat=t():e.atat=t()}(window,function(){return(r={},i.m=n=[function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.noop=function(){},t.VALUE_NAME_OUTSIDE="outside",t.VALUE_NAME_INSIDE="inside",t.HTML_RULES={'"':"&#34;","&":"&#38;","'":"&#39;","/":"&#47;","<":"&#60;",">":"&#62;"},t.CLEAR_TAGS=/[-[\](){}*+?.,\\^$|#\s]/g,t.MATCH_HTML=/&(?!#?\w+;)|<|>|"|'|\//g},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);function i(e,t){if("[object Array]"===Object.prototype.toString.call(e))for(var n=0,r=e.length;n<r;n+=1)t(e[n],n,e);else for(var i in e)e.hasOwnProperty(i)&&t(e[i],i,e)}function o(e){return void 0===e&&(e=""),e.toString().replace(r.MATCH_HTML,function(e){return r.HTML_RULES[e]||e})}function u(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(0===t.length)return String.prototype.trim.call(e);for(var r=e;0<=t.indexOf(e.charAt(0));)r=e.substring(1);for(;0<=t.indexOf(e.charAt(e.length-1));)r=e.substring(0,e.length-1);return r}function a(e){return JSON.stringify(e)}function l(e,t){return void 0===e&&(e=[]),void 0===t&&(t=""),Array.prototype.join.call(e,t)}function s(e){return void 0===e&&(e=""),e.toString().toUpperCase()}function c(e){return void 0===e&&(e=""),e.toString().toLowerCase()}t.helpers={encode:o,join:l,json:a,lower:c,upper:s},t.merge=function e(t,n){for(var r in void 0===n&&(n={}),t)!n.hasOwnProperty(r)&&t.hasOwnProperty(r)&&("object"==typeof t[r]?n[r]=e(t[r]):n[r]=t[r]);return n},t.get_tags=function(e){var n=[];i(e,function(e,t){-1===n.indexOf(t)&&n.push(t)});var r=[];return i(e,function(e,t){r.push({compiler:e,regexp:new RegExp(t,"g")})}),{compilers:r,close:/}@/g,open:new RegExp(n.join("|"),"g")}},t.get_tags_inline=function(e){var n=[];return i(e,function(e,t){n.push(t)}),n.push("(@[A-Za-z0-9$]+\\()([^]*?)(\\)@)"),new RegExp(n.join("|"),"g")},t.loop=i,t.loop_async=function(e,t,r){for(var i=0,o=!1,u=[],a=e.length,n=0;n<a;n+=1)t(e[n],n,e,l(n));function l(n){return function(e,t){if(!o){if(e)return o=!0,void r(e);u[n]=t,(i+=1)===a&&(o=!0,r(null,u))}}}},t.encode_html=o,t.trim_string=u,t.escape_quotes=function(e){return u(e).replace(/^"(.*)"$/g,"$1").replace(/^'(.*)'$/g,"$1")},t.json_stringify=a,t.join_helper=l,t.uppercase_helper=s,t.lowercase_helper=c,t.resolveUrl=function(e,t){var n=e.split("/"),r=t.split("/");n.pop();for(var i=0,o=r;i<o.length;i++){var u=o[i];"."!==u&&(".."===u?n.pop():n.push(u))}return n.join("/")}},function(e,u,t){"use strict";Object.defineProperty(u,"__esModule",{value:!0});var a=t(0),l=t(6),s=t(7),r=t(1),o=t(9),i=t(5);u.atat={config:function(e){var t=r.merge(i.DEFAULT_OPTIONS,e);for(var n in t)i.DEFAULT_OPTIONS.hasOwnProperty(n)&&(i.DEFAULT_OPTIONS[n]=t[n])},parse:function(e,t,n){void 0===t&&(t={}),void 0===n&&(n=a.noop);var i=t,r=n;if("function"==typeof i&&(r=i,i={}),r===a.noop&&"undefined"!=typeof Promise)return new Promise(function(n,r){u.atat.parse(e,i,function(e,t){e?r(e):n(t)})});var o=new s.AtatContext(i);(new l.AtatCompiler).compile(e,o,function(e,t){if(e)return r(e);var n=new Function(o.arguments,t+";return this.output;");o.template=function(e){try{o.output="",o.model=e||o.model;var t=n.call(o,o.model,o.helpers,o.body);return o.layout&&(o.layout.context.body=t,t=o.layout(o.model)),t}catch(e){return e.toString()}},o.template.context=o,r(null,o.template)})},loadAndParse:function(e,t,n){void 0===t&&(t={}),void 0===n&&(n=a.noop);var i=t,r=n;if("function"==typeof i&&(r=i,i={}),r===a.noop&&"undefined"!=typeof Promise)return new Promise(function(n,r){u.atat.loadAndParse(e,i,function(e,t){e?r(e):n(t)})});o.load_file(e,function(e,t){e?r(e):u.atat.parse(t,i,r)})},render:function(e,i,t,n){void 0===i&&(i={}),void 0===t&&(t={}),void 0===n&&(n=a.noop);var o=t,r=n;if("function"==typeof o&&(r=o,o={}),r===a.noop&&"undefined"!=typeof Promise)return new Promise(function(n,r){u.atat.render(e,i,o,function(e,t){e?r(e):n(t)})});u.atat.parse(e,o,function(e,t){e?r(e):r(null,t(i))})},loadAndRender:function(e,i,t,n){void 0===t&&(t={}),void 0===n&&(n=a.noop);var o=t,r=n;if("function"==typeof o&&(r=o,o={}),r===a.noop&&"undefined"!=typeof Promise)return new Promise(function(n,r){u.atat.loadAndRender(e,i,o,function(e,t){e?r(e):n(t)})});u.atat.loadAndParse(e,o,function(e,t){e?r(e):r(null,t(i))})},__express:function(e,n,r){u.atat.loadAndParse(e,function(e,t){e?r(e.toString()):r(null,t(n))})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=n(0);function h(e,t,n){void 0===n&&(n=0),t.lastIndex=n;var r=t.exec(e);return t.global&&(t.lastIndex=r?t.lastIndex:0),r}function c(e){for(var t=0;t<e.length;t+=1)void 0===e[t]&&(e.splice(t,1),t-=1)}t.match_recursive=function(e,t,n){for(var r,i,o,u,a=t.global,l=t.sticky,s=[],c=0,f=0,p=0,v=0;;){if(o=h(e,t,p),u=h(e,n,p),o&&u&&(o.index<=u.index?u=null:o=null),o||u)p=(f=(o||u).index)+(o||u)[0].length;else if(!c)break;if(l&&!c&&v<f)break;if(o)c||(r=f,i=p),c+=1;else{if(!u||!c)throw new Error("Unbalanced delimiter found in string");if(!(c-=1)&&(v<r&&s.push({name:d.VALUE_NAME_OUTSIDE,value:e.slice(v,r),start:v,end:r}),s.push({name:d.VALUE_NAME_INSIDE,value:e.slice(i,f),start:i,end:f,left:{value:e.slice(r,i),start:r,end:i},right:{value:e.slice(f,p),start:f,end:p}}),v=p,!a))break}f===p&&(p+=1)}return a&&e.length>v&&s.push({end:e.length,name:d.VALUE_NAME_OUTSIDE,start:v,value:e.slice(v)}),s},t.regexp_test=function(e,t,n){void 0===n&&(n=0),t.lastIndex=n;var r=t.test(e);return t.global&&(t.lastIndex=r?t.lastIndex:0),r},t.regexp_exec=h,t.clean_array=c,t.match_inline=function(e,t){for(var n,r,i=t.global,o=t.sticky,u=[],a=0,l=0;;){var s=h(e,t,a);if(null===s)break;if(l=s.index,o&&a<l)break;if(c(s),r=a+(n=l+s[1].length)+s[2].length,a<l&&u.push({name:d.VALUE_NAME_OUTSIDE,value:e.slice(a,l),start:a,end:l}),u.push({name:d.VALUE_NAME_INSIDE,value:s[2],start:n,end:r,left:{value:s[1],start:l,end:n},right:{value:s[3],start:r,end:r+s[3].length}}),a=l+s[0].length,!i)break}return i&&e.length>a&&u.push({name:d.VALUE_NAME_OUTSIDE,value:e.slice(a),start:a,end:e.length}),u}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=n(2),a=n(1);t.inlineTags={"(@!\\()([^]*?)(\\)@)":function(e,t,n){try{""===e.value.trim()&&n(),n(null,"this.output += ("+e.value.trim()+");")}catch(e){n(e)}},"(@\\()([^]*?)(\\)@)":function(e,t,n){try{""===e.value.trim()&&n(),n(null,"this.output += this.helpers.encode("+e.value.trim()+");")}catch(e){n(e)}},"(@layout\\()([^]*?)(\\)@)":function(e,n,r){try{if(n.layout)return r();u.atat.loadAndParse(a.escape_quotes(e.value),n.options,function(e,t){if(e)return r(e);(n.layout=t).context.parent=n,r()})}catch(e){r(e)}},"(@partial\\()([^]*?)(\\)@)":function(e,r,i){try{var t=e.value.trim();if(""===t)return i(new Error("Partial parsing error"));var o=t.split(/\s*,\s*/g),n=a.escape_quotes(o.shift());u.atat.loadAndParse(n,r.options,function(e,t){if(e)return i(e);r.partials.push(t);var n="this.output += this.partials["+((t.context.parent=r).partials.length-1)+"]("+o+");";i(null,n)})}catch(e){i(e)}},"(@section\\()([^]*?)(\\)@)":function(e,t,n){try{var r="this.output += (function(){var s = this.section('"+a.escape_quotes(e.value)+"'); return s?s("+t.arguments+'):"";}).call(this);';n(null,r)}catch(e){n(e)}}},t.output_call_helper=function(e,t,n){try{var r=e.left.value.substring(1,e.left.value.length-1);if("function"!=typeof t.helpers[r])throw new Error("Helper "+r+" isn't declarated");n(null,"this.output += this.helpers."+r+"("+e.value.trim()+");")}catch(e){n(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_OPTIONS={$:"$",basepath:"",cache:!0,helpers:{},it:"it"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=n(0),r=n(1),f=n(4),i=n(3),o=(u.prototype.compile=function(e,l,n){var s=this;try{if(0===e.length)return void n(null,"");var t=i.match_recursive(e,l.tags.open,l.tags.close);r.loop_async(t,function(e,t,n,r){try{if(e.name===c.VALUE_NAME_OUTSIDE)return""===e.value.trim()?void r(null,""):void s.compile_inline(e.value,l,r);if(e.name===c.VALUE_NAME_INSIDE){var i=e.left,o=e,u=e.right,a=l.compiler(i.value);return a?void a.call(s,o,l,r):void s.compile_inline(i.value+o.value+u.value,l,r)}}catch(e){r(e)}},function(e,t){if(e)return n(e);n(null,t.join(""))})}catch(e){n(e)}},u.prototype.compile_inline=function(e,l,n){var s=this;try{if(0===e.length)return void n(null,"");var t=i.match_inline(e,l.inline);r.loop_async(t,function(e,t,n,r){try{if(e.name===c.VALUE_NAME_OUTSIDE)return l.parts.push(e.value),void r(null,"this.output += this.parts["+(l.parts.length-1)+"];");if(e.name===c.VALUE_NAME_INSIDE){var i=e.left,o=e,u=e.right;if(""===o.value.trim())return void r(null,"");var a=l.compiler(i.value+o.value+u.value);return a?void a.call(s,o,l,r):void f.output_call_helper.call(s,o,l,r)}}catch(e){r(e)}},function(e,t){if(e)return n(e);n(null,t.join(""))})}catch(e){n(e)}},u);function u(){}t.AtatCompiler=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(4),o=n(5),u=n(3),a=n(8),l=(s.prototype.section=function(e){return e?this.sections[e]||this.parent&&this.parent.section(e):null},s.prototype.compiler=function(e){void 0===e&&(e="");for(var t=0,n=this.tags.compilers.length;t<n;t+=1){var r=this.tags.compilers[t];if(u.regexp_test(e,r.regexp))return r.compiler}return null},s);function s(e){var n=this;this.options=r.merge(o.DEFAULT_OPTIONS,e),this.helpers=r.merge(r.helpers,e.helpers),this.model=null,this.output="",this.parts=[],this.parent=null,this.arguments=[this.options.it,this.options.$,"body"].join(","),this.tags=r.get_tags(a.tags),this.inline=r.get_tags_inline(i.inlineTags),r.loop(i.inlineTags,function(e,t){n.tags.compilers.push({compiler:e,regexp:new RegExp(t,"g")})}),this.layout=null,this.partials=[],this.sections={}}t.AtatContext=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),u=n(0),l=n(1),s=n(3);t.tags={"@\\{":function(e,t,n){n(null,e.value.trim())},"@for\\s*\\(":function(e,t,n){var r="for("+e.value+"}",i=s.match_recursive(r,/\{/g,/\}/g),o="";o+=i[0].value,o+="{",this.compile(i[1].value,t,function(e,t){if(e)return n(e);o+=t,n(null,o+="}")})},"@function\\s+[$A-Za-z0-9]*\\s*\\(":function(e,t,n){var r=e.left.value.trim().substring(1);n(null,""+r+e.value.trim()+"}")},"@if\\s*\\(":function(e,i,n){var o=this,t="if("+e.value+"}",r=s.match_recursive(t,/\{/g,/\}/g);l.loop_async(r,function(e,t,n,r){if(e.name===u.VALUE_NAME_OUTSIDE)return r(null,e.value);o.compile(e.value,i,r)},function(e,t){if(e)return n(e);n(null,t.join(""))})},"@section\\s+[$A-Za-z0-9]*\\s*\\{":function(e,n,r){var t=e.value.trim(),i=e.left.value.trim(),o=s.regexp_exec(i,/^@section\s+([A-Za-z0-9]+)\s*\{/g);if(!o||2<o.length)return r(new Error("Section parsing error"));var u=o[1].trim();if(n.sections[u])return r(new Error("Section already exists"));a.atat.parse(t,n.options,function(e,t){if(e)return r(e);(t.context.parent=n).sections[u]=t,r(null)})},"@while\\s*\\(":function(e,t,n){var r="while("+e.value+"}",i=s.match_recursive(r,/\{/g,/\}/g),o="";o+=i[0].value,o+="{",this.compile(i[1].value,t,function(e,t){if(e)return n(e);o+=t,n(null,o+="}")})}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.load_file=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.onreadystatechange=function(){4===this.readyState&&(200<=this.status&&this.status<400?t(null,this.responseText):t(new Error('Not able to load template "'+e+'"')))},n.send(),n=null}}],i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=2)).atat;function i(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,i),t.l=!0,t.exports}var n,r});
//# sourceMappingURL=atat.min.js.map